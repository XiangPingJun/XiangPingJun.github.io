<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
	<script src="https://unpkg.com/vue@2.6.12"></script>
	<title>IB Margin Call Calculator</title>
</head>

<body>
	<div id="app" class="p-2">
		<div class="form-horizontal">
			<div class="form-group">
				<div class="col-1 col-12">
					<label class="form-label">現金</label>
				</div>
				<div class="col-3 col-12">
					<input
						v-model.number="cash"
						@keydown.up.prevent="cash = (cash || 0) + 1000"
						@keydown.down.prevent="cash = (cash || 0) - 1000"
						type="number"
						class="form-input"
					>
				</div>
				<div class="col-1 col-12">
					<span class="mx-1" />
					<button class="btn" @click="cash = (cash || 0) + 1000" tabindex="-1">＋</button>
					<button class="btn" @click="cash = (cash || 0) - 1000" tabindex="-1">－</button>
				</div>
			</div>
			<div class="form-group">
				<div class="col-1 col-12">
					<label class="form-label">現有股數</label>
				</div>
				<div class="col-3 col-12">
					<input v-model.number="volume" type="number" class="form-input">
				</div>
			</div>
			<div class="form-group">
				<div class="col-1 col-12">
					<label class="form-label">再買金額</label>
				</div>
				<div class="col-3 col-12">
					<input
						v-model.number="buyCash"
						@keydown.up.prevent="buyCash = (buyCash || 0) + 1000"
						@keydown.down.prevent="buyCash = (buyCash || 0) - 1000"
						type="number"
						class="form-input"
					>
				</div>
				<div class="col-1 col-12">
					<span class="mx-1" />
					<button class="btn" @click="buyCash = (buyCash || 0) + 1000" tabindex="-1">＋</button>
					<button class="btn" @click="buyCash = (buyCash || 0) - 1000" tabindex="-1">－</button>
				</div>
			</div>
			<div class="form-group">
				<div class="col-1 col-12">
					<label class="form-label">最新股價</label>
				</div>
				<div class="col-3 col-12">
					<input v-model.number="buyPrice" type="number" class="form-input">
				</div>
				<div class="col-1 col-12">
					<span class="mx-1" />
					<button class="btn" @click="buyPrice = (buyPrice || 0) + 1" tabindex="-1">＋</button>
					<button class="btn" @click="buyPrice = (buyPrice || 0) - 1" tabindex="-1">－</button>
				</div>
			</div>
			<div class="form-group">
				<div class="col-1 col-12">
					<label class="form-label">保險最低價</label>
				</div>
				<div class="col-3 col-12">
					<input v-model.number="lowPrice" type="number" class="form-input">
				</div>
				<div class="col-1 col-12">
					<span class="mx-1" />
					<button class="btn" @click="lowPrice = (lowPrice || 0) + 1" tabindex="-1">＋</button>
					<button class="btn" @click="lowPrice = (lowPrice || 0) - 1" tabindex="-1">－</button>
				</div>
			</div>
		</div>
		<h5 v-if="marginCall > 0 || marginCall === 0" class="text-success">
			*安全水位 ${{marginCall}}
		</h5>
		<h5 v-else-if="marginCall < 0" class="text-error">
			*追加保證金 ${{marginCall}}
		</h5>
		<h5 v-else class="text-warning">
			*請填妥欄位
		</h5>
	</div>

	<script>
		new Vue({
			el: '#app',
			data() {
				return {
					cash: '',
					volume: '',
					buyCash: '',
					buyPrice: '',
					lowPrice: '',
				}
			},
			computed: {
				marginCall() {
					if (this.cash === '' || this.volume === '' || this.lowPrice === '') {
						return null
					}
					if(this.buyCash && this.buyPrice) {
						const newVolume = this.volume + Math.floor(this.buyCash / this.buyPrice)
						return Math.floor(this.cash - (this.buyCash || 0) + this.lowPrice * newVolume * 0.75)
					}
					return Math.floor(this.cash + this.lowPrice * this.volume * 0.75)
				},
			},
		})
	</script>
</body>

</html>