<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
	<script src="https://unpkg.com/vue@2.6.12"></script>
	<title>IB Margin Call Calculator</title>
</head>

<body>
	<div id="app" class="p-2" v-cloak>
		<div class="container mb-2">
			<div class="columns">
				<div class="column col-2 d-flex">
					<pre class="form-label m-0 mr-1">現金: </pre>
					<input v-model.number="cash" type="number" class="form-input">
				</div>
			</div>

			<div class="columns mt-1">
				<div class="column col-2 d-flex">
					<pre class="form-label m-0 mr-1">代號A:</pre>
					<input v-model.number="symbolA" class="form-input">
				</div>
				<div class="column col-2 d-flex">
					<pre class="form-label m-0 mr-1">現有股數A:</pre>
					<input v-model.number="volumeA" class="form-input">
				</div>
				<div class="column col-2 d-flex">
					<pre class="form-label m-0 mr-1">保險最低價A:</pre>
					<input v-model.number="lowPriceA" class="form-input">
				</div>
				<div class="column col-2 d-flex">
					<pre class="form-label m-0 mr-1">等值資產A: {{lowPriceA * volumeA || '--'}}</pre>
				</div>
			</div>

			<div class="columns mt-1">
				<div class="column col-2 d-flex">
					<pre class="form-label m-0 mr-1">代號B:</pre>
					<input v-model.number="symbolB" class="form-input">
				</div>
				<div class="column col-2 d-flex">
					<pre class="form-label m-0 mr-1">現有股數B:</pre>
					<input v-model.number="volumeB" class="form-input">
				</div>
				<div class="column col-2 d-flex">
					<pre class="form-label m-0 mr-1">保險最低價B:</pre>
					<input v-model.number="lowPriceB" class="form-input">
				</div>
				<div class="column col-2 d-flex">
					<pre class="form-label m-0 mr-1">等值資產B: {{lowPriceB * volumeB || '--'}}</pre>
				</div>
			</div>

			<div class="columns mt-1">
				<div class="column col-2 d-flex">
					<pre class="form-label m-0 mr-1">代號C:</pre>
					<input v-model.number="symbolC" class="form-input">
				</div>
				<div class="column col-2 d-flex">
					<pre class="form-label m-0 mr-1">現有股數C:</pre>
					<input v-model.number="volumeC" class="form-input">
				</div>
				<div class="column col-2 d-flex">
					<pre class="form-label m-0 mr-1">保險最低價C:</pre>
					<input v-model.number="lowPriceC" class="form-input">
				</div>
				<div class="column col-2 d-flex">
					<pre class="form-label m-0 mr-1">等值資產C: {{lowPriceC * volumeC || '--'}}</pre>
				</div>
			</div>

			<div class="columns mt-2">
				<div class="column col-3 d-flex">
					<pre class="form-label m-0 mr-1">再買金額:</pre>
					<input v-model.number="buyCash" @keydown.up.prevent="buyCash = (buyCash || 0) + 1000"
						@keydown.down.prevent="buyCash = (buyCash || 0) - 1000" type="number" class="form-input">
				</div>
				<div class="column col-1">
					<button class="btn" @click="buyCash = (buyCash || 0) + 1000" tabindex="-1">＋</button>
					<button class="btn" @click="buyCash = (buyCash || 0) - 1000" tabindex="-1">－</button>
				</div>
			</div>

			<div class="columns mt-1">
				<div class="column col-3 d-flex">
					<pre class="form-label m-0 mr-1">最新股價:</pre>
					<input v-model.number="buyPrice" type="number" class="form-input">
				</div>
			</div>

			<div class="columns mt-1">
				<div class="column col-3 d-flex">
					<pre class="form-label m-0 mr-1">保險低價:</pre>
					<input v-model.number="lowPrice" type="number" class="form-input">
				</div>
			</div>
		</div>
		<h5 v-if="marginCall > 0 || marginCall === 0" class="text-success">
			*安全水位 ${{marginCall}} ＊記得要檢查SMA
		</h5>
		<h5 v-else-if="marginCall < 0" class="text-error">
			*追加保證金 ${{marginCall}}
		</h5>
		<h5 v-else class="text-warning">
			*請填妥欄位
		</h5>
	</div>

	<script>
		new Vue({
			el: '#app',
			data() {
				return {
					cash: 0,
					symbolA: '',
					volumeA: 0,
					lowPriceA: 0,
					symbolB: '',
					volumeB: 0,
					lowPriceB: 0,
					symbolC: '',
					volumeC: 0,
					lowPriceC: 0,
					...JSON.parse(localStorage.data || '{}'),
					buyCash: 0,
					buyPrice: 0,
					lowPrice: 0,
				}
			},
			computed: {
				marginCall() {
					const buyVolume = this.buyCash / this.buyPrice || 0
					const stockValue = this.lowPriceA * this.volumeA + this.lowPriceB * this.volumeB + this.lowPriceC * this.volumeC + this.buyVolume * this.lowPrice
					console.log(this.buyCash, this.buyPrice, buyVolume, stockValue)
					const elv = this.cash + stockValue
					const mm = stockValue * 0.25
					return elv - mm
				},
			},
			watch: {
				$data: {
					handler: function (val) {
						localStorage.data = JSON.stringify(val)
					},
					deep: true
				}
			}
		})
	</script>
</body>

</html>