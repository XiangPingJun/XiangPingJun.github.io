(function(e){function t(t){for(var r,s,i=t[0],c=t[1],u=t[2],d=0,p=[];d<i.length;d++)s=i[d],o[s]&&p.push(o[s][0]),o[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(p.length)p.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,i=1;i<n.length;i++){var c=n[i];0!==o[c]&&(r=!1)}r&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},o={app:0},a=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/tomato-day/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"53a2":function(e,t,n){"use strict";var r=n("86a9"),o=n.n(r);o.a},"86a9":function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("main-page")},a=[],s=n("d225"),i=n("308d"),c=n("6bb5"),u=n("4e2b"),l=n("9ab4"),d=n("60a3"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{margin:"5px"}},[n("div",{staticClass:"columns"},[n("div",{staticClass:"column col-12",staticStyle:{"margin-bottom":"10px"}},[n("where-am-i")],1),n("div",{staticClass:"column col-6"},["HOME"===e.whereAmI?n("bus-info"):n("countdown")],1),n("div",{staticClass:"column col-6"},["HOME"===e.whereAmI?n("countdown"):n("bus-info")],1)])])},f=[],b=(n("8e6e"),n("ac6a"),n("456d"),n("bd86")),m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("bus-info",{attrs:{bus:e.bus,busArrivingSoon:e.busArrivingSoon,skipUntil:e.skipUntil},on:{onEnabledChange:e.setBusEnabled}})},h=[],v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card"},[n("div",{staticClass:"card-header"},[n("div",{staticClass:"card-title h5 title"},[n("div",{staticClass:"text"},[e._v("1032 Bus Info (Skip until "+e._s(e.skipUntil)+")")])]),n("div",{staticClass:"card-subtitle text-gray"})]),n("div",{staticClass:"card-body"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"form-checkbox"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.enabledModel,expression:"enabledModel"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.enabledModel)?e._i(e.enabledModel,null)>-1:e.enabledModel},on:{change:function(t){var n=e.enabledModel,r=t.target,o=!!r.checked;if(Array.isArray(n)){var a=null,s=e._i(n,a);r.checked?s<0&&(e.enabledModel=n.concat([a])):s>-1&&(e.enabledModel=n.slice(0,s).concat(n.slice(s+1)))}else e.enabledModel=o}}}),n("i",{staticClass:"form-icon"}),e._v(" Enable tracking\n      ")])]),e.enabledModel?n("div",[e.loading?n("div",{staticClass:"loading loading"}):e._e(),isNaN(e.bus.arriveIn)?e._e():n("h2",{class:{"text-warning":e.busArrivingSoon}},[e._v(e._s(e.bus.arriveIn)+" minute(s).")]),e.bus.errorMessage?n("h2",{staticClass:"text-error"},[e._v(e._s(e.bus.errorMessage))]):e._e(),e._l(e.bus.busStopData,function(t){return n("div",[n("div",{class:{"text-bold":"進站中"==t.predictionTime||"即將進站"==t.predictionTime}},[e._v(e._s(t.name)+" "+e._s(t.predictionTime))])])})],2):e._e(),e.enabledModel?e._e():n("div",[n("h2",{staticClass:"text-gray"},[e._v("(Tracking disabled)")])])])])},w=[],O={props:{bus:{type:Object,required:!0},busArrivingSoon:{type:Boolean,required:!1},skipUntil:{type:String,required:!0}},data:function(){return{enabledModel:this.bus.enabled}},computed:{loading:function(){return void 0===this.bus.arriveIn&&void 0===this.bus.errorMessage},arrivingAt:function(){return!isNaN(this.arriveIn)&&this.arriveIn+" minute(s)"}},watch:{enabledModel:function(e,t){this.$emit("onEnabledChange",e)},bus:{deep:!0,handler:function(e,t){this.enabledModel=e.enabled}}}},y=O,g=n("2877"),j=Object(g["a"])(y,v,w,!1,null,null,null),A=j.exports,C=n("2f62");function _(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(n,!0).forEach(function(t){Object(b["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var I={components:{BusInfo:A},computed:E({},Object(C["e"])(["bus"]),{},Object(C["c"])(["busArrivingSoon","skipUntil"])),methods:E({},Object(C["b"])(["setBusEnabled"]))},P=I,M=Object(g["a"])(P,m,h,!1,null,null,null),k=M.exports,S=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("countdown",{attrs:{countdown:e.countdown,countdownWillEndAfter:e.countdownWillEndAfter},on:{onControlCountdown:e.controlCountdown,onChangeType:e.setCountdownType}})},T=[],x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card"},[e._m(0),n("div",{staticClass:"card-body"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"form-radio form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.typeModel,expression:"typeModel"}],attrs:{type:"radio",value:"WORK"},domProps:{checked:e._q(e.typeModel,"WORK")},on:{change:function(t){e.typeModel="WORK"}}}),n("i",{staticClass:"form-icon"}),e._v(" Work\n      ")]),n("label",{staticClass:"form-radio form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.typeModel,expression:"typeModel"}],attrs:{type:"radio",value:"SHORT_BREAK"},domProps:{checked:e._q(e.typeModel,"SHORT_BREAK")},on:{change:function(t){e.typeModel="SHORT_BREAK"}}}),n("i",{staticClass:"form-icon"}),e._v(" Short Break\n      ")]),n("label",{staticClass:"form-radio form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.typeModel,expression:"typeModel"}],attrs:{type:"radio",value:"LONG_BREAK"},domProps:{checked:e._q(e.typeModel,"LONG_BREAK")},on:{change:function(t){e.typeModel="LONG_BREAK"}}}),n("i",{staticClass:"form-icon"}),e._v(" Long Break\n      ")])]),n("h2",[e._v(e._s(e.countdownWillEndAfter))]),"START"===e.countdown.playback?n("div",{staticClass:"btn-group btn-group-block"},[n("button",{staticClass:"btn",attrs:{onclick:"this.blur();"},on:{click:function(t){return e.$emit("onControlCountdown","PAUSE")}}},[e._v("❚❚ Pause")]),n("button",{staticClass:"btn",attrs:{onclick:"this.blur();"},on:{click:function(t){return e.$emit("onControlCountdown","STOP")}}},[e._v("■ Stop")])]):n("div",{staticClass:"btn-group btn-group-block"},[n("button",{staticClass:"btn",attrs:{onclick:"this.blur();"},on:{click:function(t){return e.$emit("onControlCountdown","START")}}},[e._v("▶ Start")])])])])},D=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card-header"},[n("div",{staticClass:"card-title h5"},[e._v("Countdown Timer")])])}],B={props:{countdown:{required:!0},countdownWillEndAfter:{required:!1}},data:function(){var e=this;return{typeModel:this.countdown.type,spaceKeyListener:function(t){" "===t.key&&("START"===e.countdown.playback?e.$emit("onControlCountdown","PAUSE"):e.$emit("onControlCountdown","START"))}}},created:function(){document.addEventListener("keypress",this.spaceKeyListener)},beforeDestroy:function(){document.removeEventListener("keypress",this.spaceKeyListener)},watch:{typeModel:function(e,t){this.$emit("onChangeType",e)},countdown:{deep:!0,handler:function(e,t){this.typeModel=e.type}}}},R=B,N=Object(g["a"])(R,x,D,!1,null,null,null),W=N.exports;function K(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(n,!0).forEach(function(t){Object(b["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var H={components:{Countdown:W},computed:$({},Object(C["e"])(["countdown"]),{},Object(C["c"])(["countdownWillEndAfter"])),methods:$({},Object(C["d"])(["controlCountdown","setCountdownType"]))},F=H,q=Object(g["a"])(F,S,T,!1,null,null,null),L=q.exports,U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("where-am-i",{attrs:{whereAmI:e.whereAmI},on:{onWhereAmIChange:e.setWhereAmI}})},G=[],J=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card"},[n("div",{staticClass:"card-header"},[n("div",{staticClass:"card-title h5 title"},[n("div",[e._v("Where am I ?")]),n("button",{staticClass:"btn btn-link",on:{click:function(t){return e.showNotify("Test")}}},[e._v("Test Notification")])])]),n("div",{staticClass:"card-body"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"form-radio form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.whereAmIModel,expression:"whereAmIModel"}],attrs:{type:"radio",value:"OFFICE"},domProps:{checked:e._q(e.whereAmIModel,"OFFICE")},on:{change:function(t){e.whereAmIModel="OFFICE"}}}),n("i",{staticClass:"form-icon"}),e._v(" Office\n      ")]),n("label",{staticClass:"form-radio form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.whereAmIModel,expression:"whereAmIModel"}],attrs:{type:"radio",value:"HOME"},domProps:{checked:e._q(e.whereAmIModel,"HOME")},on:{change:function(t){e.whereAmIModel="HOME"}}}),n("i",{staticClass:"form-icon"}),e._v(" Home\n      ")])])])])},V=[];function z(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(n,!0).forEach(function(t){Object(b["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Y={props:{whereAmI:{required:!0}},data:function(){return{whereAmIModel:this.whereAmI}},methods:Q({},Object(C["b"])(["showNotify"])),watch:{whereAmIModel:function(e,t){this.$emit("onWhereAmIChange",e)},whereAmI:function(e,t){this.whereAmIModel=e}}},X=Y,Z=(n("53a2"),Object(g["a"])(X,J,V,!1,null,"3fd03972",null)),ee=Z.exports;function te(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(n,!0).forEach(function(t){Object(b["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var re={components:{WhereAmI:ee},computed:ne({},Object(C["e"])(["whereAmI"])),methods:ne({},Object(C["b"])(["setWhereAmI"]))},oe=re,ae=Object(g["a"])(oe,U,G,!1,null,null,null),se=ae.exports;function ie(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(n,!0).forEach(function(t){Object(b["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ue={components:{WhereAmI:se,BusInfo:k,Countdown:L},created:function(){this.init()},computed:ce({},Object(C["e"])(["whereAmI"])),methods:ce({},Object(C["b"])(["init"]))},le=ue,de=Object(g["a"])(le,p,f,!1,null,null,null),pe=de.exports,fe=function(e){function t(){return Object(s["a"])(this,t),Object(i["a"])(this,Object(c["a"])(t).apply(this,arguments))}return Object(u["a"])(t,e),t}(d["b"]);fe=l["a"]([Object(d["a"])({components:{MainPage:pe}})],fe);var be=fe,me=be,he=Object(g["a"])(me,o,a,!1,null,null,null),ve=he.exports,we=(n("a481"),n("7514"),n("7f7f"),n("96cf"),n("3b8d"));n("6b54"),n("f576");function Oe(){var e={whereAmI:"OFFICE",bus:{enabled:!1},countdown:{passed:0,playback:"STOP",type:"WORK"}};return void 0!==localStorage.whereAmI&&(e.whereAmI=localStorage.whereAmI),"HOME"===e.whereAmI&&(e.bus.enabled=!0),e}r["default"].use(C["a"]);var ye=new C["a"].Store({state:Oe(),getters:{busArrivingSoon:function(e){return void 0!==e.bus.arriveIn&&12>=e.bus.arriveIn},countdownWillEndAfter:function(e,t){var n=t.countdownTarget-e.countdown.passed;return 0>=n?void 0:"".concat(Math.floor(n/60).toString().padStart(2,"0"),":").concat((n%60).toString().padStart(2,"0"))},countdownTarget:function(e){switch(e.countdown.type){case"WORK":return 1500;case"SHORT_BREAK":return 300;case"LONG_BREAK":return 900}},skipUntil:function(e){return"OFFICE"===e.whereAmI?"18:00":"08:50"}},mutations:{setWhereAmI:function(e,t){e.whereAmI=t,r["default"].delete(e.bus,"arriveIn"),r["default"].delete(e.bus,"errorMessage"),localStorage.whereAmI=t},setBusArriveIn:function(e,t){r["default"].delete(e.bus,"errorMessage"),r["default"].set(e.bus,"arriveIn",t)},setBusErrorMessage:function(e,t){r["default"].delete(e.bus,"arriveIn"),r["default"].set(e.bus,"errorMessage",t)},setBusStopData:function(e,t){r["default"].set(e.bus,"busStopData",t)},setBusEnabled:function(e,t){r["default"].delete(e.bus,"arriveIn"),r["default"].delete(e.bus,"errorMessage"),r["default"].set(e.bus,"enabled",t)},setCountdownType:function(e,t){r["default"].set(e.countdown,"type",t),r["default"].set(e.countdown,"playback","STOP"),r["default"].set(e.countdown,"passed",0)},setCountdownPassed:function(e,t){r["default"].set(e.countdown,"passed",t)},controlCountdown:function(e,t){r["default"].set(e.countdown,"playback",t),"STOP"===t&&r["default"].set(e.countdown,"passed",0)}},actions:{init:function(e){var t=e.state,n=e.getters,r=e.commit,o=e.dispatch,a=function(){t.bus.enabled&&o("getBusTime")};setInterval(a,9e4),a();var s=document.querySelector('link[rel*="icon"]');s||(s=document.createElement("link"),s.type="image/x-icon",s.rel="shortcut icon",document.getElementsByTagName("head")[0].appendChild(s)),setInterval(function(){"START"===t.countdown.playback&&(r("setCountdownPassed",t.countdown.passed+1),t.countdown.passed>=n.countdownTarget&&(o("showNotify","".concat(t.countdown.type," timer!")),r("setCountdownPassed",0),r("controlCountdown","STOP"),r("setCountdownType","WORK"===t.countdown.type?"SHORT_BREAK":"WORK"))),s.href=t.countdown.playback.toLowerCase()+".ico",document.title=n.countdownWillEndAfter},1e3)},showNotify:function(){var e=Object(we["a"])(regeneratorRuntime.mark(function e(t,n){var r,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=t.state,e.next=3,Notification.requestPermission();case 3:o=new Notification(n),"HOME"===r.whereAmI&&setTimeout(function(){return o.close()},2e3),new Audio("./snap.mp3").play();case 6:case"end":return e.stop()}},e)}));function t(t,n){return e.apply(this,arguments)}return t}(),setWhereAmI:function(e,t){var n=e.commit,r=e.dispatch;n("setWhereAmI",t),"HOME"===t?(n("setBusEnabled",!0),r("getBusTime")):n("setBusEnabled",!1)},setBusEnabled:function(e,t){var n=e.commit,r=e.dispatch;t&&r("getBusTime"),n("setBusEnabled",t)},getBusTime:function(){var e=Object(we["a"])(regeneratorRuntime.mark(function e(t){var n,r,o,a,s,i,c,u,l,d,p,f,b,m,h;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=t.state,r=t.getters,o=t.commit,a=t.dispatch,o("setBusStopData",void 0),e.prev=2,s="",i="https://script.google.com/macros/s/AKfycby4UfKogRD746jlIWF2mq4Bm3rVY5Bej4icgvmz0k3ucmQPeAk/exec?",i+="url=http%3A%2F%2Fwww.taiwanbus.tw%2Fapp_api%2FSP_PredictionTime_V3.ashx%3F","HOME"===n.whereAmI?(i+="routeNo%3D1032%26branch%3D0%26goBack%3D1%26Lang%3D%26Source%3Dw%26runid%3D4948",s="南港車站"):(i+="routeNo%3D1032%26branch%3D0%26goBack%3D2%26Lang%3D%26Source%3Dw%26runid%3D4949",s="和平高中"),e.next=9,fetch(i);case 9:if(c=e.sent,c.ok){e.next=12;break}throw new Error("Unable to get bus info!");case 12:return e.next=14,c.json();case 14:if(u=e.sent,"HOME"===n.whereAmI?(l=37,d=54):(l=14,d=31),o("setBusStopData",u[0].stopInfo.slice(l,d).map(function(e){return{name:e.name,predictionTime:e.predictionTime}})),p=0,f=u[0].stopInfo.find(function(e){return s===e.name}).predictionTime,b=/(\d+)時/.exec(f),b instanceof Array&&(p+=60*parseInt(b[1],10)),b=/(\d+)分/.exec(f),!(b instanceof Array)){e.next=26;break}p+=parseInt(b[1],10),e.next=28;break;case 26:if(/\d+:\d+/.exec(f)||"進站中"===f||"即將進站"===f){e.next=28;break}throw new Error("Unable to parse predictionTime: "+f);case 28:o("setBusArriveIn",p),m=100*(new Date).getHours()+(new Date).getMinutes(),h=parseInt(r.skipUntil.replace(":",""),10),r.busArrivingSoon&&m>h&&a("showNotify",p),e.next=38;break;case 34:e.prev=34,e.t0=e["catch"](2),o("setBusErrorMessage",e.t0.message),a("showNotify",e.t0.message);case 38:case"end":return e.stop()}},e,null,[[2,34]])}));function t(t){return e.apply(this,arguments)}return t}()}});r["default"].config.productionTip=!1,new r["default"]({store:ye,render:function(e){return e(ve)}}).$mount("#app")}});
//# sourceMappingURL=app.b5f76c1d.js.map