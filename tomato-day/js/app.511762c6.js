(function(t){function e(e){for(var i,s,a=e[0],c=e[1],u=e[2],f=0,d=[];f<a.length;f++)s=a[f],o[s]&&d.push(o[s][0]),o[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);l&&l(e);while(d.length)d.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,a=1;a<n.length;a++){var c=n[a];0!==o[c]&&(i=!1)}i&&(r.splice(e--,1),t=s(s.s=n[0]))}return t}var i={},o={app:0},r=[];function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var u=0;u<a.length;u++)e(a[u]);var l=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},cd49:function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("097d");var i=n("2b0e"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main-page")},r=[],s=n("d4ec"),a=n("99de"),c=n("7e84"),u=n("262e"),l=n("9ab4"),f=n("60a3"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{"margin-top":"5px"}},[n("div",{staticClass:"columns"},[n("div",{staticClass:"column col-6"},[n("bus-info")],1),n("div",{staticClass:"column col-6"},[n("notify-config")],1)]),t.notification.message?n("notify"):t._e()],1)},p=[],b=n("be94"),v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("bus-info",{attrs:{bus:t.bus},on:{onDirectionChange:t.saveBusDirection}})},h=[],m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"card"},[t._m(0),n("div",{staticClass:"card-body"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"form-radio form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.directionModel,expression:"directionModel"}],attrs:{type:"radio",value:"DEAPRTURE"},domProps:{checked:t._q(t.directionModel,"DEAPRTURE")},on:{change:function(e){t.directionModel="DEAPRTURE"}}}),n("i",{staticClass:"form-icon"}),t._v(" Deaprture\n      ")]),n("label",{staticClass:"form-radio form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.directionModel,expression:"directionModel"}],attrs:{type:"radio",value:"RETURN"},domProps:{checked:t._q(t.directionModel,"RETURN")},on:{change:function(e){t.directionModel="RETURN"}}}),n("i",{staticClass:"form-icon"}),t._v(" Return\n      ")]),t.loading?n("div",{staticClass:"loading loading"}):t._e(),isNaN(t.bus.arriveIn)?t._e():n("h2",[t._v(t._s(t.bus.arriveIn)+" minute(s).")]),t.bus.errorMessage?n("h2",{staticClass:"text-error"},[t._v(t._s(t.bus.errorMessage))]):t._e()])]),n("div",{staticClass:"card-footer"})])},_=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"card-header"},[n("div",{staticClass:"card-title h5"},[t._v("1032 Bus Info")]),n("div",{staticClass:"card-subtitle text-gray"})])}],g={props:{bus:{type:Object,required:!0}},data:function(){return{directionModel:this.bus.direction}},computed:{loading:function(){return void 0===this.bus.arriveIn&&void 0===this.bus.errorMessage},arrivingAt:function(){return!isNaN(this.arriveIn)&&this.arriveIn+" minute(s)"}},watch:{directionModel:function(t,e){this.$emit("onDirectionChange",t)}}},y=g,w=n("2877"),I=Object(w["a"])(y,m,_,!1,null,null,null);I.options.__file="BusInfo.vue";var T=I.exports,C=n("2f62"),O={components:{BusInfo:T},created:function(){this.subscribeBusTime()},computed:Object(b["a"])({},Object(C["d"])(["bus"])),methods:Object(b["a"])({},Object(C["b"])(["subscribeBusTime","saveBusDirection"]))},N=O,x=Object(w["a"])(N,v,h,!1,null,null,null);x.options.__file="BusInfo.vue";var E=x.exports,j=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("notify-config",{attrs:{types:t.notification.types},on:{onTypeChange:t.setNotifyType,onNotify:t.showNotify}})},k=[],B=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"card"},[t._m(0),n("div",{staticClass:"card-body"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"form-checkbox form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.page_title,expression:"page_title"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.page_title)?t._i(t.page_title,null)>-1:t.page_title},on:{change:function(e){var n=t.page_title,i=e.target,o=!!i.checked;if(Array.isArray(n)){var r=null,s=t._i(n,r);i.checked?s<0&&(t.page_title=n.concat([r])):s>-1&&(t.page_title=n.slice(0,s).concat(n.slice(s+1)))}else t.page_title=o}}}),n("i",{staticClass:"form-icon"}),t._v(" Page title\n      ")]),n("label",{staticClass:"form-checkbox form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.web_notifications,expression:"web_notifications"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.web_notifications)?t._i(t.web_notifications,null)>-1:t.web_notifications},on:{change:function(e){var n=t.web_notifications,i=e.target,o=!!i.checked;if(Array.isArray(n)){var r=null,s=t._i(n,r);i.checked?s<0&&(t.web_notifications=n.concat([r])):s>-1&&(t.web_notifications=n.slice(0,s).concat(n.slice(s+1)))}else t.web_notifications=o}}}),n("i",{staticClass:"form-icon"}),t._v(" Web notification\n      ")])]),0===t.testCountdown?n("button",{staticClass:"btn",on:{click:t.test}},[t._v("Test")]):t._e(),0!==t.testCountdown?n("button",{staticClass:"btn",attrs:{disabled:""}},[t._v(t._s(t.testCountdown)+" second(s)...")]):t._e()]),n("div",{staticClass:"card-footer"})])},M=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"card-header"},[n("div",{staticClass:"card-title h5"},[t._v("Notify Config")]),n("div",{staticClass:"card-subtitle text-gray"})])}],A=(n("6762"),n("2fdb"),n("ac6a"),n("5df3"),n("4f7f"),{props:{types:{types:Set,required:!0}},data:function(){return{page_title:this.types.includes("PAGE_TITLE"),web_notifications:this.types.includes("WEB_NOTIFICATIONS"),testCountdown:0,testIntervalID:void 0}},watch:{page_title:function(t,e){this.onTypeChange()},web_notifications:function(t,e){this.onTypeChange()}},methods:{onTypeChange:function(){var t=[];this.page_title&&t.push("PAGE_TITLE"),this.web_notifications&&t.push("WEB_NOTIFICATIONS"),this.$emit("onTypeChange",t)},test:function(){var t=this;this.testCountdown=3,this.testIntervalID=setInterval(function(){t.testCountdown--,0===t.testCountdown&&(clearInterval(t.testIntervalID),t.$emit("onNotify","Test notification!"))},1e3)}}}),P=A,D=Object(w["a"])(P,B,M,!1,null,null,null);D.options.__file="NotifyConfig.vue";var S=D.exports,R={components:{NotifyConfig:S},computed:Object(b["a"])({},Object(C["d"])(["notification"])),methods:Object(b["a"])({},Object(C["c"])(["setNotifyType"]),Object(C["b"])(["showNotify"]))},U=R,q=Object(w["a"])(U,j,k,!1,null,null,null);q.options.__file="NotifyConfig.vue";var L=q.exports,W=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("notify",{attrs:{notification:t.notification}})},F=[],G=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div")},J=[],V=(n("96cf"),n("1da1")),z={props:["notification"],data:function(){return{intervalID:void 0}},created:function(){var t=Object(V["a"])(regeneratorRuntime.mark(function t(){var e,n,i=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.notification.types.includes("PAGE_TITLE")&&(e=!1,this.intervalID=setInterval(function(){var t=document.querySelector('link[rel*="icon"]')||document.createElement("link");e?(t.href="/favicon.ico",document.title=i.notification.message||""):(t.href="/blank.ico",document.title=""),e=!e},500)),!this.notification.types.includes("WEB_NOTIFICATIONS")){t.next=6;break}return t.next=4,Notification.requestPermission();case 4:n=new Notification(this.notification.message),setTimeout(function(){return n.close()},2e3);case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},H=z,K=Object(w["a"])(H,G,J,!1,null,null,null);K.options.__file="Notify.vue";var Q=K.exports,X={components:{Notify:Q},computed:Object(b["a"])({},Object(C["d"])(["notification"]))},Y=X,Z=Object(w["a"])(Y,W,F,!1,null,null,null);Z.options.__file="Notify.vue";var $=Z.exports,tt={components:{BusInfo:E,NotifyConfig:L,Notify:$},computed:Object(b["a"])({},Object(C["d"])(["notification"]))},et=tt,nt=Object(w["a"])(et,d,p,!1,null,null,null);nt.options.__file="MainPage.vue";var it=nt.exports,ot=function(t){function e(){return Object(s["a"])(this,e),Object(a["a"])(this,Object(c["a"])(e).apply(this,arguments))}return Object(u["a"])(e,t),e}(f["b"]);ot=l["a"]([Object(f["a"])({components:{MainPage:it}})],ot);var rt=ot,st=rt,at=Object(w["a"])(st,o,r,!1,null,null,null);at.options.__file="App.vue";var ct=at.exports;n("7f7f"),n("7514");function ut(){var t={bus:{direction:"DEAPRTURE"},notification:{types:["PAGE_TITLE","WEB_NOTIFICATIONS"]}};return void 0!==localStorage.busDirection&&(t.bus.direction=localStorage.busDirection),void 0!==localStorage.notifyType&&(t.notification.types=JSON.parse(localStorage.notifyType)),t}i["default"].use(C["a"]);var lt=new C["a"].Store({state:ut(),mutations:{setBusDirection:function(t,e){i["default"].delete(t.bus,"arriveIn"),i["default"].delete(t.bus,"errorMessage"),i["default"].set(t.bus,"direction",e),localStorage.busDirection=e},setBusArriveIn:function(t,e){i["default"].delete(t.bus,"errorMessage"),i["default"].set(t.bus,"arriveIn",e)},setBusErrorMessage:function(t,e){i["default"].delete(t.bus,"arriveIn"),i["default"].set(t.bus,"errorMessage",e)},setBusIntervalID:function(t,e){i["default"].set(t.bus,"intervalID",e)},setNotifyType:function(t,e){i["default"].set(t.notification,"type",e),localStorage.notifyType=JSON.stringify(e)},setNotifyMessage:function(t,e){e?i["default"].set(t.notification,"message",e):i["default"].delete(t.notification,"message")}},actions:{showNotify:function(t,e){var n=t.commit;n("setNotifyMessage",e),setTimeout(function(){return n("setNotifyMessage",void 0)})},saveBusDirection:function(t,e){var n=t.state,o=t.dispatch;i["default"].delete(n.bus,"arriveIn"),i["default"].delete(n.bus,"errorMessage"),i["default"].set(n.bus,"direction",e),localStorage.busDirection=e,o("loadBusTime")},subscribeBusTime:function(t){var e=t.state,n=t.commit,o=t.dispatch;clearInterval(e.bus.intervalID),i["default"].delete(e.bus,"intervalID"),o("loadBusTime");var r=setInterval(function(){return o("loadBusTime")},6e4);n("setBusIntervalID",r)},loadBusTime:function(){var t=Object(V["a"])(regeneratorRuntime.mark(function t(e){var n,i,o,r,s,a,c,u,l,f;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return n=e.state,i=e.commit,o=e.dispatch,t.prev=1,r="","DEAPRTURE"===n.bus.direction?(s="https://cors.io/?http://www.taiwanbus.tw/app_api/SP_PredictionTime_V3.ashx?routeNo=1032&branch=0&goBack=2&Lang=&Source=w&runid=4949",r="南港車站"):(s="https://cors.io/?http://www.taiwanbus.tw/app_api/SP_PredictionTime_V3.ashx?routeNo=1032&branch=0&goBack=1&Lang=&Source=w&runid=4948",r="和平高中"),t.next=6,fetch(s);case 6:if(a=t.sent,a.ok){t.next=9;break}throw new Error("Unable to get bus info!");case 9:return t.next=11,a.json();case 11:if(c=t.sent,u=0,l=c[0].stopInfo.find(function(t){return r===t.name}).predictionTime,f=/(\d+)時/.exec(l),f instanceof Array&&(u+=60*parseInt(f[1],10)),f=/(\d+)分/.exec(l),!(f instanceof Array)){t.next=21;break}u+=parseInt(f[1],10),t.next=23;break;case 21:if("進站中"===l||"即將進站"===l){t.next=23;break}throw new Error("Unable to parse predictionTime: "+l);case 23:112>=u&&o("showNotify",u),i("setBusArriveIn",u),t.next=31;break;case 27:t.prev=27,t.t0=t["catch"](1),i("setBusErrorMessage",t.t0.message),o("showNotify",t.t0.message);case 31:case"end":return t.stop()}},t,this,[[1,27]])}));function e(e){return t.apply(this,arguments)}return e}()}});i["default"].config.productionTip=!1,new i["default"]({store:lt,render:function(t){return t(ct)}}).$mount("#app")}});
//# sourceMappingURL=app.511762c6.js.map