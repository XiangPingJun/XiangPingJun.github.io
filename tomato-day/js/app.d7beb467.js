(function(e){function t(t){for(var o,s,i=t[0],c=t[1],u=t[2],d=0,p=[];d<i.length;d++)s=i[d],r[s]&&p.push(r[s][0]),r[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);l&&l(t);while(p.length)p.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,i=1;i<n.length;i++){var c=n[i];0!==r[c]&&(o=!1)}o&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},r={app:0},a=[];function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},cd49:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("097d");var o=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("main-page")},a=[],s=n("d4ec"),i=n("99de"),c=n("7e84"),u=n("262e"),l=n("9ab4"),d=n("60a3"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{margin:"5px"}},[n("div",{staticClass:"columns"},[n("div",{staticClass:"column col-12",staticStyle:{"margin-bottom":"10px"}},[n("where-am-i")],1),n("div",{staticClass:"column col-6"},["HOME"===e.whereAmI?n("bus-info"):n("countdown")],1),n("div",{staticClass:"column col-6"},["HOME"===e.whereAmI?n("countdown"):n("bus-info")],1)])])},f=[],m=n("be94"),b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("bus-info",{attrs:{bus:e.bus,busArrivingSoon:e.busArrivingSoon},on:{onEnabledChange:e.setBusEnabled}})},h=[],v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card"},[e._m(0),n("div",{staticClass:"card-body"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"form-checkbox"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.enabledModel,expression:"enabledModel"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.enabledModel)?e._i(e.enabledModel,null)>-1:e.enabledModel},on:{change:function(t){var n=e.enabledModel,o=t.target,r=!!o.checked;if(Array.isArray(n)){var a=null,s=e._i(n,a);o.checked?s<0&&(e.enabledModel=n.concat([a])):s>-1&&(e.enabledModel=n.slice(0,s).concat(n.slice(s+1)))}else e.enabledModel=r}}}),n("i",{staticClass:"form-icon"}),e._v(" Enable tracking\n      ")])]),e.enabledModel?n("div",[e.loading?n("div",{staticClass:"loading loading"}):e._e(),isNaN(e.bus.arriveIn)?e._e():n("h2",{class:{"text-warning":e.busArrivingSoon}},[e._v(e._s(e.bus.arriveIn)+" minute(s).")]),e.bus.errorMessage?n("h2",{staticClass:"text-error"},[e._v(e._s(e.bus.errorMessage))]):e._e(),e._l(e.bus.busStopData,function(t){return n("div",[n("div",{class:{"text-bold":"進站中"==t.predictionTime||"即將進站"==t.predictionTime}},[e._v(e._s(t.name)+" "+e._s(t.predictionTime))])])})],2):e._e(),e.enabledModel?e._e():n("div",[n("h2",{staticClass:"text-gray"},[e._v("(Tracking disabled)")])])])])},w=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card-header"},[n("div",{staticClass:"card-title h5"},[e._v("1032 Bus Info")]),n("div",{staticClass:"card-subtitle text-gray"})])}],g={props:{bus:{type:Object,required:!0},busArrivingSoon:{type:Boolean,required:!1}},data:function(){return{enabledModel:this.bus.enabled}},computed:{loading:function(){return void 0===this.bus.arriveIn&&void 0===this.bus.errorMessage},arrivingAt:function(){return!isNaN(this.arriveIn)&&this.arriveIn+" minute(s)"}},watch:{enabledModel:function(e,t){this.$emit("onEnabledChange",e)},bus:{deep:!0,handler:function(e,t){this.enabledModel=e.enabled}}}},_=g,y=n("2877"),A=Object(y["a"])(_,v,w,!1,null,null,null);A.options.__file="BusInfo.vue";var C=A.exports,O=n("2f62"),I={components:{BusInfo:C},computed:Object(m["a"])({},Object(O["e"])(["bus"]),Object(O["c"])(["busArrivingSoon"])),methods:Object(m["a"])({},Object(O["b"])(["setBusEnabled"]))},M=I,E=Object(y["a"])(M,b,h,!1,null,null,null);E.options.__file="BusInfo.vue";var S=E.exports,T=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("countdown",{attrs:{countdown:e.countdown,countdownWillEndAfter:e.countdownWillEndAfter},on:{onControlCountdown:e.controlCountdown,onChangeType:e.setCountdownType}})},k=[],j=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card"},[e._m(0),n("div",{staticClass:"card-body"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"form-radio form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.typeModel,expression:"typeModel"}],attrs:{type:"radio",value:"WORK"},domProps:{checked:e._q(e.typeModel,"WORK")},on:{change:function(t){e.typeModel="WORK"}}}),n("i",{staticClass:"form-icon"}),e._v(" Work\n      ")]),n("label",{staticClass:"form-radio form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.typeModel,expression:"typeModel"}],attrs:{type:"radio",value:"SHORT_BREAK"},domProps:{checked:e._q(e.typeModel,"SHORT_BREAK")},on:{change:function(t){e.typeModel="SHORT_BREAK"}}}),n("i",{staticClass:"form-icon"}),e._v(" Short Break\n      ")]),n("label",{staticClass:"form-radio form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.typeModel,expression:"typeModel"}],attrs:{type:"radio",value:"LONG_BREAK"},domProps:{checked:e._q(e.typeModel,"LONG_BREAK")},on:{change:function(t){e.typeModel="LONG_BREAK"}}}),n("i",{staticClass:"form-icon"}),e._v(" Long Break\n      ")])]),n("h2",[e._v(e._s(e.countdownWillEndAfter))]),"START"===e.countdown.playback?n("div",{staticClass:"btn-group btn-group-block"},[n("button",{staticClass:"btn",attrs:{onclick:"this.blur();"},on:{click:function(t){e.$emit("onControlCountdown","PAUSE")}}},[e._v("❚❚ Pause")]),n("button",{staticClass:"btn",attrs:{onclick:"this.blur();"},on:{click:function(t){e.$emit("onControlCountdown","STOP")}}},[e._v("■ Stop")])]):n("div",{staticClass:"btn-group btn-group-block"},[n("button",{staticClass:"btn",attrs:{onclick:"this.blur();"},on:{click:function(t){e.$emit("onControlCountdown","START")}}},[e._v("▶ Start")])])])])},x=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card-header"},[n("div",{staticClass:"card-title h5"},[e._v("Countdown Timer")])])}],B={props:{countdown:{required:!0},countdownWillEndAfter:{required:!1}},data:function(){var e=this;return{typeModel:this.countdown.type,spaceKeyListener:function(t){"START"===e.countdown.playback?e.$emit("onControlCountdown","PAUSE"):e.$emit("onControlCountdown","START")}}},created:function(){document.addEventListener("keypress",this.spaceKeyListener)},beforeDestroy:function(){document.removeEventListener("keypress",this.spaceKeyListener)},watch:{typeModel:function(e,t){this.$emit("onChangeType",e)},countdown:{deep:!0,handler:function(e,t){this.typeModel=e.type}}}},P=B,R=Object(y["a"])(P,j,x,!1,null,null,null);R.options.__file="Countdown.vue";var W=R.exports,N={components:{Countdown:W},computed:Object(m["a"])({},Object(O["e"])(["countdown"]),Object(O["c"])(["countdownWillEndAfter"])),methods:Object(m["a"])({},Object(O["d"])(["controlCountdown","setCountdownType"]))},K=N,D=Object(y["a"])(K,T,k,!1,null,null,null);D.options.__file="Countdown.vue";var F=D.exports,H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("where-am-i",{attrs:{whereAmI:e.whereAmI},on:{onWhereAmIChange:e.setWhereAmI}})},L=[],q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card"},[e._m(0),n("div",{staticClass:"card-body"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"form-radio form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.whereAmIModel,expression:"whereAmIModel"}],attrs:{type:"radio",value:"OFFICE"},domProps:{checked:e._q(e.whereAmIModel,"OFFICE")},on:{change:function(t){e.whereAmIModel="OFFICE"}}}),n("i",{staticClass:"form-icon"}),e._v(" Office\n      ")]),n("label",{staticClass:"form-radio form-inline"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.whereAmIModel,expression:"whereAmIModel"}],attrs:{type:"radio",value:"HOME"},domProps:{checked:e._q(e.whereAmIModel,"HOME")},on:{change:function(t){e.whereAmIModel="HOME"}}}),n("i",{staticClass:"form-icon"}),e._v(" Home\n      ")])])])])},G=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card-header"},[n("div",{staticClass:"card-title h5"},[e._v("Where am I ?")])])}],U={props:{whereAmI:{required:!0}},data:function(){return{whereAmIModel:this.whereAmI}},computed:{},watch:{whereAmIModel:function(e,t){this.$emit("onWhereAmIChange",e)},whereAmI:function(e,t){this.whereAmIModel=e}}},J=U,V=Object(y["a"])(J,q,G,!1,null,null,null);V.options.__file="WhereAmI.vue";var z=V.exports,Q={components:{WhereAmI:z},computed:Object(m["a"])({},Object(O["e"])(["whereAmI"])),methods:Object(m["a"])({},Object(O["b"])(["setWhereAmI"]))},X=Q,Y=Object(y["a"])(X,H,L,!1,null,null,null);Y.options.__file="WhereAmI.vue";var Z=Y.exports,$={components:{WhereAmI:Z,BusInfo:S,Countdown:F},created:function(){this.init()},computed:Object(m["a"])({},Object(O["e"])(["whereAmI"])),methods:Object(m["a"])({},Object(O["b"])(["init"]))},ee=$,te=Object(y["a"])(ee,p,f,!1,null,null,null);te.options.__file="MainPage.vue";var ne=te.exports,oe=function(e){function t(){return Object(s["a"])(this,t),Object(i["a"])(this,Object(c["a"])(t).apply(this,arguments))}return Object(u["a"])(t,e),t}(d["b"]);oe=l["a"]([Object(d["a"])({components:{MainPage:ne}})],oe);var re=oe,ae=re,se=Object(y["a"])(ae,r,a,!1,null,null,null);se.options.__file="App.vue";var ie=se.exports,ce=(n("7514"),n("7f7f"),n("96cf"),n("1da1"));n("6b54"),n("f576");function ue(){var e={whereAmI:"OFFICE",bus:{enabled:!1},countdown:{passed:0,playback:"STOP",type:"WORK"}};return void 0!==localStorage.whereAmI&&(e.whereAmI=localStorage.whereAmI),"HOME"===e.whereAmI&&(e.bus.enabled=!0),e}o["default"].use(O["a"]);var le=new O["a"].Store({state:ue(),getters:{busArrivingSoon:function(e){return void 0!==e.bus.arriveIn&&12>=e.bus.arriveIn},countdownWillEndAfter:function(e,t){var n=t.countdownTarget-e.countdown.passed;return 0>=n?void 0:"".concat(Math.floor(n/60).toString().padStart(2,"0"),":").concat((n%60).toString().padStart(2,"0"))},countdownTarget:function(e){switch(e.countdown.type){case"WORK":return 1500;case"SHORT_BREAK":return 300;case"LONG_BREAK":return 900}}},mutations:{setWhereAmI:function(e,t){e.whereAmI=t,o["default"].delete(e.bus,"arriveIn"),o["default"].delete(e.bus,"errorMessage"),localStorage.whereAmI=t},setBusArriveIn:function(e,t){o["default"].delete(e.bus,"errorMessage"),o["default"].set(e.bus,"arriveIn",t)},setBusErrorMessage:function(e,t){o["default"].delete(e.bus,"arriveIn"),o["default"].set(e.bus,"errorMessage",t)},setBusStopData:function(e,t){o["default"].set(e.bus,"busStopData",t)},setBusEnabled:function(e,t){o["default"].delete(e.bus,"arriveIn"),o["default"].delete(e.bus,"errorMessage"),o["default"].set(e.bus,"enabled",t)},setCountdownType:function(e,t){o["default"].set(e.countdown,"type",t),o["default"].set(e.countdown,"playback","STOP"),o["default"].set(e.countdown,"passed",0)},setCountdownPassed:function(e,t){o["default"].set(e.countdown,"passed",t)},controlCountdown:function(e,t){o["default"].set(e.countdown,"playback",t),"STOP"===t&&o["default"].set(e.countdown,"passed",0)}},actions:{init:function(e){var t=e.state,n=e.getters,o=e.commit,r=e.dispatch,a=function(){t.bus.enabled&&r("getBusTime")};setInterval(a,9e4),a();var s=document.querySelector('link[rel*="icon"]');s||(s=document.createElement("link"),s.type="image/x-icon",s.rel="shortcut icon",document.getElementsByTagName("head")[0].appendChild(s)),setInterval(function(){"START"===t.countdown.playback&&(o("setCountdownPassed",t.countdown.passed+1),t.countdown.passed>=n.countdownTarget&&(r("showNotify","".concat(t.countdown.type," timer!")),o("setCountdownPassed",0),o("controlCountdown","STOP"),o("setCountdownType","WORK"===t.countdown.type?"SHORT_BREAK":"WORK"))),s.href=t.countdown.playback.toLowerCase()+".ico",document.title=n.countdownWillEndAfter},1e3)},showNotify:function(){var e=Object(ce["a"])(regeneratorRuntime.mark(function e(t,n){var o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o=t.state,e.next=3,Notification.requestPermission();case 3:r=new Notification(n),"HOME"===o.whereAmI?setTimeout(function(){return r.close()},2e3):new Audio("./snap.mp3").play();case 5:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}(),setWhereAmI:function(e,t){var n=e.commit,o=e.dispatch;n("setWhereAmI",t),"HOME"===t?(n("setBusEnabled",!0),o("getBusTime")):n("setBusEnabled",!1)},setBusEnabled:function(e,t){var n=e.commit,o=e.dispatch;t&&o("getBusTime"),n("setBusEnabled",t)},getBusTime:function(){var e=Object(ce["a"])(regeneratorRuntime.mark(function e(t){var n,o,r,a,s,i,c,u,l,d,p,f,m;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=t.state,o=t.getters,r=t.commit,a=t.dispatch,r("setBusStopData",void 0),e.prev=2,s="","HOME"===n.whereAmI?(i="https://jsonp.afeld.me/?url=http%3A%2F%2Fwww.taiwanbus.tw%2Fapp_api%2FSP_PredictionTime_V3.ashx%3FrouteNo%3D1032%26branch%3D0%26goBack%3D2%26Lang%3D%26Source%3Dw%26runid%3D4948",s="南港車站"):(i="//jsonp.afeld.me/?url=http%3A%2F%2Fwww.taiwanbus.tw%2Fapp_api%2FSP_PredictionTime_V3.ashx%3FrouteNo%3D1032%26branch%3D0%26goBack%3D2%26Lang%3D%26Source%3Dw%26runid%3D4949",s="和平高中"),e.next=7,fetch(i);case 7:if(c=e.sent,c.ok){e.next=10;break}throw new Error("Unable to get bus info!");case 10:return e.next=12,c.json();case 12:if(u=e.sent,"HOME"===n.whereAmI?(l=37,d=54):(l=14,d=31),r("setBusStopData",u[0].stopInfo.slice(l,d).map(function(e){return{name:e.name,predictionTime:e.predictionTime}})),p=0,f=u[0].stopInfo.find(function(e){return s===e.name}).predictionTime,m=/(\d+)時/.exec(f),m instanceof Array&&(p+=60*parseInt(m[1],10)),m=/(\d+)分/.exec(f),!(m instanceof Array)){e.next=24;break}p+=parseInt(m[1],10),e.next=26;break;case 24:if("進站中"===f||"即將進站"===f){e.next=26;break}throw new Error("Unable to parse predictionTime: "+f);case 26:r("setBusArriveIn",p),o.busArrivingSoon&&a("showNotify",p),e.next=34;break;case 30:e.prev=30,e.t0=e["catch"](2),r("setBusErrorMessage",e.t0.message),a("showNotify",e.t0.message);case 34:case"end":return e.stop()}},e,this,[[2,30]])}));function t(t){return e.apply(this,arguments)}return t}()}});o["default"].config.productionTip=!1,new o["default"]({store:le,render:function(e){return e(ie)}}).$mount("#app")}});
//# sourceMappingURL=app.d7beb467.js.map