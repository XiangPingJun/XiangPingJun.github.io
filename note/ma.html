<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      LqIW4pFg0dAiSlThaasLrmfFq/ZVK84jGf05pGO2nJ0=:kqlj2sWQMlgqA0sD1MuKoA==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
