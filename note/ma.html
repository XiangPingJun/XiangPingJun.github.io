<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      dCabGudDXEtngPDV2f4V8U7xDSZvKcUTXudHGfxKto8=:fzV1Z5wGWk9FU8l7YBxO6Q==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
