<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      gs5UngLWwM/fwoEmfN3sm+qHjgIWR34lmZMYoO494i4=:HvGkzggEUfOmOTR+gBbAYA==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
