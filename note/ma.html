<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      jlairIJ1GNSbYU/iTOU2QGakiX58hPJuoE3qRUWEv+M=:TOeghTZsS7CyzVTLCBejYg==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
