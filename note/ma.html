<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      dY/lRXppAWraYyZ0vU8Ul4HgKedj9sjbFV0eSX285Z8=:MlFV/bJiELuJCdVh3F4qYA==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
