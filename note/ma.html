<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      ehERX83f9BrGtGRI97kHtT68L2rs0mPrsznrlLsNLpc=:89ox/Y9WMZpoaojwo+XDKw==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
