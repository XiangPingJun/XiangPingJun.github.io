<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      Zm4W+ZqAbM8BVBRVr6jeYq/YXoTNTBDu23p4O0Pmdl0=:zSznv8LUBJtP87ano/WKnA==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
