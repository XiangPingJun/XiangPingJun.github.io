<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      GkbObMkzAzw4xFAyZvEHbsiObberLNTmmf1+cMtgeOw=:100H7xEA71+kXOSWQtohfQ==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
