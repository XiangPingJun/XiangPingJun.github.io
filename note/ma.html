<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      dZArqBCoZojo29113efCBkITjANFfO+lq7mfGwWw3XQ=:0r40Z1HRTNYtb6w6vozHZA==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
