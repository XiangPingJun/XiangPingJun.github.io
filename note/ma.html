<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      wnZzdM9BbNYgXKN7IecBYIqVjMU4z2k8miYuDLy5K20=:OgYCqpeB6ZDUH9GuRGtr2Q==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
