<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      Vjyk+bnhJ8Y5JlJ0bmlCWYHvcsyQJXTGj8T4yT3Bh4k=:gAqxD/WEvtUQkpBK211c5A==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
