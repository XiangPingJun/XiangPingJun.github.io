<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      OEGZ6smDv2eyHLm/N0BxTTyl/UvetUBrRHHi9SN5edE=:5jdCWQVEblrxK6zYCt1aSQ==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
