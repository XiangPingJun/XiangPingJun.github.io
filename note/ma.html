<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      r42mtDdISgDEhGiW1xMMjySu7YUcpT/KXxKOc8NFC2E=:UkX+nxd9LynV1WXdagjIjQ==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
