<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      gpIC3v/nP6L1ih+/3tWGIN9ZttEANqXTrfO5Ggy2d1s=:iCPKwY9boUObXOH9tMZisA==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
