<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      YDTixDOGjqXDPmMkqPahQyRv1dfHBQla5HNhdO04zO0=:f9mbR1caZ4n3FktKRnHi/Q==:Pif2PDV0XAm9yS/9lCRp2R/mlh4kbmqNA3Rf0L+RxHcXGJq60zx6bXWBBgosebnvVNlmgQmYhhbrBU+sVIrVtm96ncOwq1dJCokZAmQOjbtHVfHcTxNojCdhlR2bK8CsmdLuywz1f4wRZ4D5DlWZratmXm8eJITknxKbsUbrcGaC3RuaLpzyasJ0A1WWmc/nfjMWP6/xEz/0tBz0m7haLkfKC9P5xMz7yt96tBVV0oRFL9XCcfbuBsJXsSYbhu3APBy76zIvfYuWWWwQdsk2JlZ1tPcrKtd7gxp9DPFoCcopY3jEZnenhHLFBV+LRcdy9q8ODv0TRanyxdz0/ZcLkuijosdnI9DVPmN8bOOs26WXn4kJii4ZS0Kr9loRmLr1sw0VxSNBU73tFivsK0J6mNCsaKIohtH8yW204ymIVecwI9uyUtetjCZw3np5NOt8xdpZlEDBrNn1kA9JYWBbWbAyGTrxnftgEcrA/SvHNoSBSLOs6dbZo4CqnjIccdTG90wdM+Cx5UGQYV+cAq+K4NrU0knBpbr/oWkUAwjXNgaOm6Gm37Hd+gcOxoWV1pVm7cbxYKDvDL82i0mMVfjvaZJ4fYcJ5j9Mgv7XG/WZPlq1FuI3O1wOYDCoFVu9lFFdy003tfM0hH15Qomnk054tnZRTEpKmRqEUJUO0W89IHjXU10zmhdubgfl6WfmjRRKHLNw2FLJyMy8/qiK7z9T+1kLHIP7lxD4UcZmclEUgu6YW+LB8dIwUAHSvdEmUnu+IZW2NHV/tW9qxvzxbxVK1HYRsGpwdeRS8kG+vorDmWlgLWsqUfxnl0VWjYWm4v1YwbfA1cYp0B8ivr2nVu5blEz+2fiVTU5ZkXaLxk0daQyW8xR91PoakyJH25ivi5Gh4pWygNL0Ob0QFBmZ15UU9FYwlJgk52W7laH/B/1XX5CMucDl4/m3urbGAJ4DVH6AD3KZv9OXzKdFDCXvGZUHv3oyjmGMsQtvmxHT2wVKvDpflUpJAl/pGNH4bSqHpm8OX6IDN/RtQOWfkuFZINyxXiMKolKqjoHUn1tv7UaRU8ioRBvpkYOcIyFWNufByhizMJMZqHtCreyyfFL1LV3s/J0dbjD8O7mzPJWDw7RGErLTvNksZ9eyNTvjEMOXGy7tWNZQ2LtegV8RI8AI4WGX17Jnqu+Qo77B7uKI6hFKURQwvSPHInoZmzOJLPNTRuLtS5eRpfZByCQ6mDgxgljgH7i5UU2GBgqJn6nGRRawcRt4gpn06RlLAHWFvU4j93VP3ImGnR6WTKtj+U/qTqd8qA5nXF+JEJCMSxVwPnmiUp7LUABLBhYlolM1bDlp8B0yVlQ1USwqUwjmnPry6w7hbAGXD5fsiASDt49zzEVOKkBmxbqOazHeauO80dwLOS7Cv2B4ZB3JGrayXy4or72o0URT5jUBlc/YTG7wKdziIHY0wxJskamzc5GtOY+SfN/91JR2Jk4sH3MVhhg5Oh11Wi6PcDzrJyiOT3RvoQtmXRoJjbiKMUlhXuHB5g+6eEVuxuEGx16KH0kVNAMl2VktGBAM63Jto6YFuThYHeGeCq0E5sdWmRxiEgZNpHjKPYaG9jts88HV9ZkgMExzm21ZVRg+mUd3LBAkxRMXy6Jzd91aNwBKf5dMbx2tyeWuBCJVYsG+zzAEjtPwOxtBti2Wjvr5j3c8cL1ysFCAOuE8eLe5CjSuJypVsVRzFhzgaY2IiM1XBgDEWYdB1LA7/0fJuxAwbsB0rULs0H6CZG0B2fqiXKBKeP7NLXsF8G7Fuz1Ws7ceufyi+zxylFlolowp9xpP7Rqu9ZBlclxkREqHyJB6v5UIVO7iihqkMkx4kaAXYymMLsHwiB/lr1JKE7z+k1VMeKpuo3cEnR9FCDNcik7T6a8QWy5G5b7kA7UIaGU4w8sU8yXm10lj0MGQnxr/5icWnmGb81R/vJLzyiRCegn21nYL8cc9CvAAdeuYZTmZe4dXKPYR6Wq1zQxW4BF7q8/PGx/7AlCN+WmTtgApOSvdaFOs0k7x9FpBS2geDPAR9hbUW2kIBo14Qc6egp02U1YrFXihrtk4nBg2UQhXQXnrLft0NtCxfyjrT97E6y40nxM1V4H+PlZHs1BW/nHcHrXhTiB7d0i7WPsuLKVRWJpsl8t+6ALeiXiSK9Wl7D7zHSPpcrXoNHUGs4Q3jNNZEJqYOJyghrgRHQjA4yXnkQjp8SVd27SCObfdyIoDZ7pEgVfcnBAA/tz9ofau98DrpUfNu+AQNXxILFMbd/l4MG/CqhTvrga9nyyONU86e0IAvJq3OIV6mdggHYt2OoQfra7Wxt775swqj/Ppe89Q1n6Qsz3sEKISC2LdmgnxJl/0FCbGfz1oV3n6Kk73g8kbbI/T3kunGmhXzsK7iplyz/9Fm1Upu2DdJHwLqCmAmGzFQkERq6CqGjaBRetuHXPsPwW5QtOyn4cF8l6M8HrKFDRcQ/1JvCipboEWSD1R7eDwD+0WZF5ArkGPHKHELH5tGUON7cWfuQ65mm4C8QsvPKk/gbowgYJz34X4JGVa+QPdc953ns88Rm5qkI+sbeXzD08nFyBoeoJa6ydzW0SKbd3Jehe4k22WUTJvYCAYy8WG40AB5fls+kjfoRglwZr5KYRu5YUfliZr330zvPERf+IPFtNCEHijeZaEGUDpy9IpLhNpv5LmW6HOZ+0uKrd40GY7PnGYsVvWs9MZSjhoheukJIHh8WeFZXWp9FN42HjuNFlr339gs7YA26MH30D+oPkQ/97lsZh8Jr3XrnEUP0IVpKRHGJ5HaoUGleWO3qldoC26qp9gaIXdEzcEtwG13pGw8EXYK6MyjUZbIpAmkexi2dfFsxWDTQMx6aeHSc423Jue9x4j4B8qc/2Pn/3xl9l+OEJudYlMIghYgOeqToAF6dNM641C8rjzPcIGoWZmJzcL7LzQrZmeAbIgzMXMH0f8wcl4mQ/w370S+11L/36efywvzSdb5BYS8sftCgw6jX9wtkWCFfD5xP/vWAA4ISV0RYyAPN56P5sMjQQUfmfjaNCWGgS82svKoBVxxz7fKbBwxjJZln1vQDofXSEIRWIitV85PEkdLGowFqReLrZgO40mdxAHkJTKEimL8GTDJT3a2GO563Pdbjb1tX4COg4diYZ7IA20SgZDEjs8AgRUXrnsBxRMzH/RIl4HarJA3n/ouTgQTP2wlUkczCuPVGipIa5G7TyLw9Epzu14mJ14h92rDhXbVML5ax0yJzIw9rwXxZC3nRHnLtMaip/HK2hB4Md64jO/hGPXU6OhsdEH+Vl/d8RpnW0dxtqS6ES6hlGLsISMssLgbXA2pp5x/FPK/xb22B+oonAf8xTqyMHZdiUNnQ50Ts6yPIJEHBHL4Yc5ObBHGqW3J4f9t4vsCMX3ZBqwbmCWytNrjQVtJzmqb3N7Nmo2ub+af67IKiTT5i+G6E9CmymLZe1pN+pT1ysDoYCpHaHt24H8tat8GBiAsdrbmT8LMjKC0Q+HTW+OVVYjudFGYGnLmxLk2rriiUGHXuYEz2ne090qFdPBaiDCd7f5YsdLvvn/CeXiLZ4A2hraM78tzXvemKONdcFpO7lSqoa5nnZ3Dfyp/rO0FMY4nZmwjMFg0cXMI5h3Hpar9WkftHg9smpF/36EWvivbLYJ8JPw+LaqPt1AMwetHeUkh95ng7sNWQs938l/gSM8rQB5RWTFVb17UQ67AeFf9eBnPoAy3+PAvvBVqfimuONKU3QTlQcxmC5mCUwnevOP7sRQaNvdZLwbXtjaHREyeppinZ42KOi+K/micsNAD2hE2SJKxx3HildW+F+Z/+J9cclcqrICp3YW/XjhE+sCf4T24YXnzwwVL6LCrcoYedhl5LBKEV0oSBEq0HptWSUxLB74xtUB9401LTqSz9rVmMUNSeNkOk3RrvHDmCAYuIHLqScz+OpDAg9h84WZ9vSY00GNGD0iKtW/NYeELUphIhqUoEc7skW/khQReEb1RVvgxBNZMGeWhInwgN78sKkEfssMQt1D327UXPlO6WKxGsyFf+8vhs9b/nEKnk+TEctFvk0n8dLNCyO/81OeAYa4GDMp5PSGTkAEZV1l0x9EEyZKz63hY+QHh5CUswOVOCs+xI+GnSclfBfj1lfBeZTJgbnmAmK3mqCvATASddlk6tDZ6NTlqXPv8drlixkc8BTEorJZo0N0KJOCzitucBxC94qZNKNJvxD2+R0AirTrYDK1IUe3AwXAAVpQYLcRsAU/hTyzigoXwJV8ixK7dkOrNRPTVmxQvC/TWMwgQz+X5q7Xna+k0VtBjbxu/vZsklKTEIUk9BXx9MBmtN0v0Oke/U+J0lZUCtpwjOxYlGTzWVvJBgq72Y63pl41DRXJ0qRcGJTWZwmn5hvZF7mzdSuCtes9pOoMxvlIShCiEk2hl9BVC8K3InezpNAcW2xodgX7bNWSsiFkijO9uWdaWNnGsYFGgYaavmy8sAWNMBxIQA+m2fSwzqh2N6S7LaAJyS4QqhMDNIEYb94GEDhAWpJMVx5An5VJ3lc79p47efLmBJYdxCkZ+RXpnBjUtHmbSEi1DgFquKD38RLMyRd7TlZxaAJ/x5FmgAd0j6yhJ20Iv3sX2HYIiFQSQUNWv3NQGUmmZkM6lpEJhtC149xut6GrSiSsW+uUxuGRX1LEhbuKI17avAoIy9jSqRN77Q3y/EQ5PIiY0Cwq7LxGT7cHsWYb2j1dCMKPr6GApUoNpuy+j/mye5OiI2jDKBSqj5BUthZY0YQIh4XnCIirtGp7DV6Hpqp2UEkdCzzStKZ7h3ssMpYhgW3Cg1WbKtguJEu3bskX5khB8M4w5fQx43s6iO9GxeOphZKuxz21hGQInLfoBuBoppg3oGG1E2EOoyHtYKyLrOhU9G+dIiQ3CccXvYY15WTLTsUDdisFp024ywrX1c1j/S7cG8TbJg7LmWEaXMXK89xa6YcQ8q8VibH1eDG23TQQCl0X6lSPgMm0UD+ZKpzVl6/OOImjlvpPgSGUbk0FXiqb5DBaBBL/2WMH52ZOeHqeNKcnGGl5AFjxxUKJ+bo0lE3VRWG3FTgxrrfpwpTkAy9IuiBVn8GLydCu7rBWRw67kpsVLeI3tVcB95YKX9VrLgJqxJSSyjA2KZiGumnJ+5wW6/YnAKgJHSelN2XXWpp+BoNiJTQG+J0Lj8KK4+pY0io4vPzx1XjVFAE5ivh1MnEo5cQiNp9gkFxUHQY8Ibt+z8J1WD5OZB20AQ+B55JvkO0brn0vgylS5PW8M2NtkldE35Os3dXeFmVzi7Fo1qZwXA5ufNLkbR8JPEmPe7Vsu3l5qOxMtsO30rC6otn2d5pfsMK5ph6ut2e2FKtDeH2Gl8R1bfw2xJ+vZUiwqqF/r48e499bqYx7xQNEEpESyRBZ1R99rcfe3CPOpOcfLJpuYs0scyjHclE4l8BSslxzrkQJi63Xc5eqc3YqDbRqY61aZmpzeKAjkkaa6djSkmtl9nRKcNcU2S1gi6k9Yvp9w3pRfcZ7h5+6Yxmh/7l57K6jT+F6wmEamGu/LL+QVCdg7IXjDK6uL5TSycwdDQ/TppZc1dF7+hoFWhhiQp8+EvZbC2Fxg/vuvLiT87E76z8+lSPEUTuhvWRB1iipwZVbk/mPIuaiL73zLWiCQkuIYiaQoaPau5FqPHfLoPORzXIeDtu9oQacvZ+e80DQFe/VU7b+iVZEom+Y92PkJX/GzekFK3vGCZ7F9pucoV207qfTuGU5bmty10am4UNBVURWP25f/zXcbo9nECajS3HoxJWSEaj57+On1GLejXSucMKGBot4GnupX+d05nL72YN3r+lWMtGD7qrWKmZK7MolbGVu7gOFYom+URGG+avioOIyRzy2qDdAdiAsHDf/B+pL1L3hHXGQvFL5OMzVvi9m7X5z4UkhNTEXdTF1vVd5WkZYAO9z93VHl5GcLjUMXdgG85Hqgs3tnVdetlqR+iUXRaZ8dQd7r9NGmP2efsj7Qz5nKKF1SLKU4WqVJ4YXUQCFnn+bX/+CoDvPV2bhT8eIhuRKZSdQFDpdcXnIaXoi421rufkNLdbXO1ADsIocFmBfe4eVatdIXB0Txp1r7ulsySLKseUkyndKK7WH3ZLi5Km1lnr4jYYoc+FmNhC80X8oFROpjCj3VOq5mggVtsA/cZGixGksV0M7dM04dPU/OfoD52oEl6ev6hKCxOrLDQpOmL59P2ZRFXeOW9vv2B3JU9BDrpce08JS4V8skZwha1rVEZ8Jc6Rcf8W65Vh2whpj2H2XxNp2/gH58w/osa4J6DsFhb0/LuYNEXNSP+6XhYs0V1b2Vy/BwfoOIsWtMaoIs52t+HFaqqWzLTU2A1bmy7sp1yasJpV/5bx1zW8SNlIOFb4Oc3jWfWdOBmLeRCi+kS7tg9ZLs6CXZwkKf4WhNSBrDvr/01rDYM+ilDmqGkIXe+uXAOrUZKW7ELf4ql2cryUs1ku+LLoB+QxE0Gi2T8E9T3xq4lTnEoN4ECzahV9/9cN9b4IoX4CWaqSUDwWZYaDjOw4YgNyKqmZmYnkf/26B9gi6ztIQE+NwFCEg8smrFNXLy06LZIXetRJMzn02z34ho4iBu0s+4fVzLF6WAMzhWo0nBbrPBa3a48uEZngV//1MUeZ/RlrMIydCPmjiu5q0CWjycumEtiYkVDrCRx4tGMWkgYtsFV8IdepKC5j1oe4Tmxp36NaU+YdjPY9HSKLZTA0DwEs1bDQYcaqFPbD/xYODwuEE4obQzQTF07hMGoUmrD/rwLR2qG/uzs2kPyp1eFZwP9refcIkW6JI9hPKGTZRFyVfc0CBmWoMAxNGB1HA8ULz36sLujmOUQGEaVPy1ILaXFMdLjQsiDluK3ec59FeguMt3E0f2bIJ6ZpP0DQAJlBJP4sxI6Y+BRrJDmcqGfuAAGvcrW2FSzSDN55MSZDLOALn8ZJAYMwSmBCF9M5X283bkoylUTrbLz8wR5Q7sz5YC1oMXk17KV/txkeuT3cXelFRTZMvSKgylQU2rxYOD4DU+lfrVS/r3DRHcC94BphkDXGcsAAN+4NhPI06weBUQNXymHkBItDfBHYdD6nSFSLE0uKMw/nuEXYLO1utNZI2HSNU3PXlhy4WoLX27iMrkV4CmtUmfEuBxg2Vb9rPlSrmanv7U+FOrY6GV95UO2z9XM2xLn4gh1/abTdaraMEUfdtQoYebdAW3UHY0Tt8YzaK0ymHKzVr4n2mXHB38Bef9KAMe2vbBvKT8Wyv89ukt4fNfsSmt7Z2OaS41JxRA9G+wxR1qbJPP+e6VnQVU7eiNN9+cl0Tvfqkgc4SdDNWgIUzZ0RE/NZ2RvDawCqpkHphWsJAe6GiD6Cm0FXo31mzaYkSoZvX5zA=
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
