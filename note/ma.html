<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      370L6DQmbqTh9weRmzDjO/6715yLE+BDSFcsNBXr8do=:whO2+yHVqEQ3JxkQ0msrAA==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
