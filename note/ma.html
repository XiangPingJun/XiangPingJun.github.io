<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      Wfbz6ZTuu56DzDaNVkig510uZvyVBFqjv+sHxKQByRA=:TCOeGmlgZQKVF8H0MgkiCg==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
