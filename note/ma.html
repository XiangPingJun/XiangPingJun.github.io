<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      Wb4tzONZRJygG7bSp6tAWPHskm5qkrALFvlNXyVw+zk=:657pNCChFgAcBRoHIL5D0Q==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
