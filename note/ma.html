<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)

  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <button onclick="generatePassword()" style="margin-left: 30px;">üé≤</button>
  <span id="genPw"></span>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      RQyqEMGndsSijvAvpRoFvrE/1GJNcxG8fpwAunheVzg=:O+vz5HQjBAzgraZxO0wUpA==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>
