<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function deriveKey(passphrase, salt) {
      return CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 100000,
        hasher: CryptoJS.algo.SHA256 // Recommended: Explicitly use SHA256
      });
    }

    function uint8ToBase64(uint8) {
      let binary = "";
      const chunkSize = 0x8000; // ÈÅøÂÖç call stack overflow

      for (let i = 0; i < uint8.length; i += chunkSize) {
        const chunk = uint8.subarray(i, i + chunkSize);
        binary += String.fromCharCode(...chunk);
      }

      return btoa(binary);
    }

    function base64ToUint8(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);

      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }

      return bytes;
    }

    async function compress(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);

      const cs = new CompressionStream("gzip");
      const writer = cs.writable.getWriter();
      writer.write(data);
      writer.close();

      const buffer = await new Response(cs.readable).arrayBuffer();
      return uint8ToBase64(new Uint8Array(buffer));
    }

    async function encrypt() {
      const passphrase = document.getElementById('kkey').value
      const value = await compress(document.getElementById('text').value.trim())

      const salt = CryptoJS.lib.WordArray.random(32)
      const key = deriveKey(passphrase, salt)
      const iv = CryptoJS.lib.WordArray.random(16)

      const cipher = CryptoJS.AES.encrypt(value, key, { iv: iv }).toString()
      const result =
        salt.toString(CryptoJS.enc.Base64) +
        ':' +
        iv.toString(CryptoJS.enc.Base64) +
        ':' +
        cipher

      document.getElementById('text').value = result
    }

    async function decompress(base64) {
      const uint8 = base64ToUint8(base64);

      const ds = new DecompressionStream("gzip");
      const writer = ds.writable.getWriter();
      writer.write(uint8);
      writer.close();

      const buffer = await new Response(ds.readable).arrayBuffer();
      return new TextDecoder().decode(buffer);
    }

    async function decrypt() {
      try {
        document.getElementById('kkey').disabled = true
        await new Promise((r) => setTimeout(r))
        const passphrase = document.getElementById('kkey').value
        const value = document.getElementById('text').value.trim()
        const parts = value.split(':')
        if (parts.length < 3) throw new Error('Invalid ciphertext')
        const salt = CryptoJS.enc.Base64.parse(parts[0])
        const iv = CryptoJS.enc.Base64.parse(parts[1])
        const ciphertext = parts.slice(2).join(':')

        let decipher = CryptoJS.AES.decrypt(ciphertext, deriveKey(passphrase, salt), { iv: iv })
        decipher = decipher.toString(CryptoJS.enc.Utf8)
        if (!decipher) {
          throw new Error('Decryption failed')
        }
        decipher = await decompress(decipher)
        document.getElementById('text').value = decipher
      } catch (err) {
        document.getElementById('kkey').style.color = 'red'
        throw err
      } finally {
        document.getElementById('kkey').disabled = false
      }
      document.getElementById('kkey').style.color = 'black'
    }

    function generatePassword() {
      const length = 12
      const lowercase = 'abcdefghijklmnopqrstuvwxyz'
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
      const digits = '0123456789'
      const allChars = lowercase + uppercase + digits

      let retVal = ''
      retVal += lowercase.charAt(Math.floor(Math.random() * lowercase.length))
      retVal += uppercase.charAt(Math.floor(Math.random() * uppercase.length))
      retVal += digits.charAt(Math.floor(Math.random() * digits.length))

      for (let i = 4, n = allChars.length; i < length; ++i) {
        retVal += allChars.charAt(Math.floor(Math.random() * n))
      }

      retVal = retVal.split('').sort(() => Math.random() - 0.5).join('') // Shuffle the password
      document.getElementById('genPw').innerText = retVal
    }

    const pageLoadTime = Date.now()
    setInterval(() => {
      if (Date.now() > pageLoadTime + 3600000) {
        location.reload()
      }
    }, 60000)
  </script>
  <style>
    * {
      font-size: 16px !important;
    }
  </style>
</head>

<body>
  <input id="kkey" type="password" style="margin-top: 5px;" onKeydown="javascript: if (event.keyCode===13) decrypt()" />
  <button onclick="decrypt()">üîë</button>
  <button onclick="encrypt()">üîí</button>
  <div>
    <textarea id="text" style="width: 100%; height: 90vh; margin-top: 5px;">
      RsCXnlsSFmuxmCD3QSmekyWTHx/0YhFmVd/jg27w22Y=:sy8neycb5DpXuERLr3lldA==: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
    </textarea>
  </div>

  <script>
    document.getElementById('kkey').focus()
  </script>
</body>

</html>